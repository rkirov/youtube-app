<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>youtube angular 2 demo app</title>
    <script src="/node_modules/systemjs/node_modules/es6-module-loader/node_modules/traceur/bin/traceur.js"></script>
    <script src="/node_modules/systemjs/node_modules/es6-module-loader/dist/es6-module-loader-sans-promises.js"></script>
    <script src="/node_modules/systemjs/dist/system.js"></script>
    <script src="/node_modules/zone.js/zone.js"></script>
    <script src="/node_modules/zone.js/long-stack-trace-zone.js"></script>
    <script src="/node_modules/hammerjs/hammer.min.js"></script>
    <script>
      // atscript with runtime-type assertions.
      System.traceurOptions = {
        annotations: true,
        memberVariables: true,
        typeAssertions: true,
        typeAssertionModule: 'rtts_assert/rtts_assert',
        types: true
      };

      System.paths = {
        // angular2
        'angular2/*':'/node_modules/angular2-es5/*.js',
        'rtts_assert/*': '/node_modules/rtts_assert-es5/*.js',
        // project own.
        'main': 'main.js',
        'components/*': 'components/*.js',
        'services/*': 'services/*.js',
      };
    </script>
  </head>
  <body>
    <youtube-app>Loading... Please wait</youtube-app>
    <script>
      System.import('main').then(function(module) {
        zone = zone.fork(Zone.longStackTraceZone);
        module.main();
      }, console.log.bind(console));
    </script>
    <script type="text/javascript">
      function googleClientReady() {
        /**
         * This patches the Promise library of the GoogleClient. If it would be using native promises 
         * this would not be necessary.
         * 
         * The issue is that the GoogleClientPromise gets triggerd from a callback which was registered before
         * angular bootstraped and hence all `then`s execute in the wrong zone. If GoogleClient would use
         * native Promise, this would not be a problem, but it does not, hence we patch the GoogleClientPromise
         * to behave the same as native Promise.
         */
        gapi.client.load = (function(delegate) {
          return function(name, ver) {
            var promise = delegate.call(this, name, ver);
            Zone.patchPrototype(promise.__proto__, [
              'then',
              'catch'
            ]);
            gapi.client.load = delegate; // Remove the Promise patch;
            return promise;
          }
        })(gapi.client.load);
      }
    </script>
    <script src="https://apis.google.com/js/client.js?onload=googleClientReady"></script>
  </body>
</html>

